{"name":"Pedal-dialect","tagline":"Dialect (database) and provider (e.g. Hibernate) specific supporting implementations for Pedal and related frameworks.","body":"pedal-dialect\r\n=============\r\n\r\nPedal-dialect, a member of the Pedal family ([pedal-tx](https://github.com/eclecticlogic/pedal-tx), [pedal-loader](https://github.com/eclecticlogic/pedal-loader)), is a collection of dialect (database) and provider (e.g. Hibernate) specific implementations for use with JPA. It enables non-standard SQL data types (arrays, sets, bit-sets) and dialect specific features such as support for the Postgresql Copy command.\r\n\r\n## Feature Highlights\r\n\r\n- Provider support (for Hibernate)\r\n\t- Access current schema name\r\n\t- Get table name for given entity (including when remapped by orm.xml)\r\n\t- Hibernate user-type (mutable and non-mutable) base classes.\r\n\t- List and Set user-types.\r\n- Postgresql specific features\r\n\t- Adaptation of List/Set type for Hibernate\r\n\t- Hibernate user-type for Postgres bit arra\r\n\t- Support for using the COPY command directly with JPA entity classes.\r\n\r\n## Getting started\r\n\r\nDownload the pedal-dialect jar from Maven central:\r\n\r\n```\r\n\t<groupId>com.eclecticlogic</groupId>\r\n\t<artifactId>pedal-dialect</artifactId>\r\n\t<version>1.0.3</version>\r\n```\r\n\r\nMinimum dependencies that you need to provide in your application:\r\n\r\n1. slf4j (over logback or log4j) v1.7.7 or higher\r\n2. Spring-boot jpa 1.2 or\r\n2. spring-tx, spring-context and spring-orm v4.0 or higher\r\n4. hibernate-core and hibernate-entitymanager 4.3 or higher.\r\n5. JDBC4 compliant driver and connection pool manager (BoneCP, HikariCP, Apache Commons DBCP2 and Tomcat JDBC are supported).\r\n\r\n\r\n## Configuration\r\n\r\nTo enable the `ProviderAccess` interface, create an instance of `HibernateProviderAccessSpiImpl` and give it a reference to the `EntityManagerFactory`. Here is the java code to use in a Spring configuration class:\r\n\r\n    \r\n    @Bean\r\n    HibernateProviderAccessSpiImpl hibernateProvider(EntityManagerFactory factory) {\r\n        HibernateProviderAccessSpiImpl impl = new HibernateProviderAccessSpiImpl();\r\n        impl.setEntityManagerFactory(factory);\r\n        return impl;\r\n    }\r\n\r\n\r\nTo enable the `CopyCommand` create an instance of it and set the ProviderAccess and an instance of a `ConnectionAccessor`. For e.g., to use it with Tomcat, the following Bean creator method can be used:\r\n\r\n    \r\n\r\n    @Bean\r\n    public CopyCommand copyCommand(ProviderAccessSpi provider) {\r\n        CopyCommand command = new CopyCommand();\r\n        command.setProviderAccessSpi(provider);\r\n        command.setConnectionAccessor(new TomcatJdbcConnectionAccessor());\r\n        return command;\r\n    }\r\n\r\n## Posgresql User Types\r\n\r\nPedal provides support (via Hibernate user-types) for a number of non-standard Postgresql data types that can really help streamline your data model. Among these are array types and bits.\r\n\r\nPedal supports `List` and `Set` types for `String`, `Integer`, `Long`, `Date`, `Boolean` and `BigDecimal` (i.e., collections of standard sql-types). To use `List` and `Set` data types, simply annotate your JPA/Hibernate entity as shown.\r\n\r\n```\r\n\r\n    @Column(name = \"authorizations\", nullable = false)\r\n    @Type(type = \"com.eclecticlogic.pedal.provider.hibernate.SetType\", parameters = @Parameter(name = ArrayType.DIALECT_PRIMITIVE_NAME, value = PostgresqlArrayPrimitiveName.STRING))\r\n    public Set<String> getAuthorizations() {\r\n        return this.authorizations;\r\n    }\r\n\r\n\r\n    @Column(name = \"scores\")\r\n    @Type(type = \"com.eclecticlogic.pedal.provider.hibernate.ListType\", parameters = { @Parameter(name = ArrayType.DIALECT_PRIMITIVE_NAME, value = PostgresqlArrayPrimitiveName.LONG) })\r\n    public List<Long> getScores() {\r\n        return this.scores;\r\n    }\r\n\r\n```\r\n\r\nPedal allows you to control how empty collections are treated - by default they are written as null values in the database, but you can change that:\r\n\r\n```\r\n\r\n    @Column(name = \"gpa\")\r\n    @Type(type = \"com.eclecticlogic.pedal.provider.hibernate.ListType\", parameters = {\r\n            @Parameter(name = ArrayType.DIALECT_PRIMITIVE_NAME, value = PostgresqlArrayPrimitiveName.LONG),\r\n            @Parameter(name = ArrayType.EMPTY_IS_NULL, value = \"false\") })\r\n    public List<Long> getGpa() {\r\n        return gpa;\r\n    }\r\n\r\n\r\n```\r\n\r\nPedal also allow mapping of Postgresql bit array to `java.util.BitSet`. \r\n\r\n```\r\n\r\n    @Column(name = \"countries\", nullable = false, length = 7)\r\n    @Type(type = \"com.eclecticlogic.pedal.provider.hibernate.dialect.PostgresqlBitStringUserType\", parameters = @Parameter(name = PostgresqlBitStringUserType.BIT_LENGTH, value = \"7\"))\r\n    public BitSet getCountries() {\r\n        return this.countries;\r\n    }\r\n\r\n\r\n```\r\n\r\nNote: The BIT_LENGTH parameter is required because Hibernate User-Types cannot access the JPA annotation.\r\n\r\n## Copy Command features\r\n\r\nThe Postgresql [Copy](http://www.postgresql.org/docs/9.1/static/sql-copy.html) command provides a very high performance insert capability. One can easily achieve 100k inserts per second using it. For background and features that are bypassed by the copy command refer to the official [documentation](http://www.postgresql.org/docs/9.1/static/sql-copy.html).\r\n\r\nThe copy command works in text or binary mode. Our tests show that the binary mode produces a larger data stream and therefore actually results in slower performance over the network. The text mode requires data to be encoded into delimited columns and rows. Such a format has a high-impedance mismatch with the typical manner in which objects are handled in an ORM. The Copy command feature of pedal overcomes this mismatch by allowing a collection of JPA entities written to the database. The pedal framework does the work of assembling the text encoding of the data in the JPA entities and it does so by creating a Javassist based custom class to optimize on performance.\r\n\r\nThe `CopyCommand` implementation in pedal currently has the following restrictions/limitations:\r\n\r\n1. `@Column` annotation must be present and is only supported on getter methods.\r\n2. `@Column` annotation must have column name in it or there should be an `@AttributeOverrides` or `@AttributeOverride` class-level annotation with the column name.\r\n3. `@Convert` annotation is only support when applied to the getter.\r\n4. Array types can only be arrays of primitives. Postgresql `bit` arrays are supported if the entity field data type is `java.util.BitSet`. Apply the `@CopyAsBitString` annotation to the getter to support writing to the Postgresql bit array. The `@Column` annotation must have the length set to the bit array length in Postgresql.\r\n5. Embedded id support if `@EmbeddedId` annotation is present and `@AttributeOverrides` annotation denotes pk columns. See `Planet` class in the test.\r\n6. No specific distinction between Temporal `TIMESTAMP` and `DATE`.\r\n\r\nThe `CopyCommand` does support a generic mechanism to support custom-types or work-around the above limitations using a `ConversionHelper`. For any field where you want to define custom conversion, apply the `@CopyConverter` annotation with a reference to an implementation of a suitable `ConversionHelper`.\r\n\r\nHere is the general pattern of usage for the Copy Command:\r\n\r\n\r\n        @PersistenceContext\r\n        private EntityManager entityManager;\r\n\r\n        ...        \r\n\r\n        \r\n        CopyList<ExoticTypes> list = new CopyList<>();\r\n\r\n        // The copy-command can insert 100k of these per second.\r\n        for (int i = 0; i < 10; i++) {\r\n            MyEntity entity = new MyEntity();\r\n            entity.setSomeField(\"value\");\r\n            entity.setSomeOtherField(\"value 2\");\r\n            list.add(et);\r\n        }\r\n\r\n        copyCommand.insert(entityManager, list);\r\n\r\n\r\n## Release Notes\r\n\r\n### 1.0.3\r\n\r\n- `PostgresqlBitStringUserType` converts to BitSet instead of List<Boolean>.\r\n\r\n### 1.0.2\r\n\r\n- ConversionHelper has been generified. See [`ExoticTypes`](https://raw.githubusercontent.com/eclecticlogic/pedal-dialect/master/src/test/java/com/eclecticlogic/pedal/dm/ExoticTypes.java) class in src/test/java of the source distribution for an example.\r\n\r\n### 1.0.1\r\n\r\n- Added UUIDBasedIdGenerator, a Hibernate id generator based on UUIDs. ","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}